using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace Start
{
    class Test
    {
        public static void Main()
        {
            Random rand = new Random();
            List<City> cities = new List<City>();
            cities.Add (new City("Москва"));
            cities.Add(new City("Питер"));
            cities.Add(new City("Казань"));
            cities.Add(new City("Владивосток"));
            bool isWorking = true;
            Renderer renderer = new Renderer(0,0);
            
            while (isWorking)
            {
                Console.Clear();
                int numberOfCarriages = 0;
                int numberOfPassangers = rand.Next(100, 1000);
                Train train = new Train(new List<Carriage>(), numberOfPassangers, numberOfCarriages, cities[0], cities[0], numberOfPassangers);
                renderer.DrawInfoWindow(train._location.Name, train._direction.Name, train._numberOfPassangersOut, train._numberOfCarriages);
                
                Console.WriteLine("Выберите направление:\n1 - Москва\n2 - Питер\n3 - Казань\n4 - Владивосток\n5- Выйти из программы");
                string userInput = Console.ReadLine();
                Console.Clear();
                
                switch (userInput)
                {
                    case "1":
                        train.GoToNextCity();
                        break;
                    case "2":
                        train.GoToNextCity();
                        break;
                    case "3":
                        train.GoToNextCity();
                        break;
                    case "4":
                        train.GoToNextCity();
                        break;
                    case "5":
                        isWorking = false;
                        break;
                }
            }
        }
    }
    class Train
    {
        Random rand = new Random();
        public City _location { get; private set;}
        public City _direction { get; private set; }
        public int _numberOfPassangersOut { get; private set; }
        public int _numberOfCarriages { get; private set; }
        private int _numberOfPassangersIn;
        List<Carriage> _carriages = new List<Carriage>();

        public Train(List<Carriage> carriages, int numberOfPassangers, int numberOfCarriages, City location, City direction, int numberOfPassangersIn)
        {
            _carriages = carriages;
            _location = location;
            _direction = direction;
            _numberOfPassangersOut = numberOfPassangers;
            _numberOfCarriages = numberOfCarriages;
            _numberOfPassangersIn = numberOfPassangersIn;
        }
        public void Fill()
        {
            _numberOfCarriages = GetNumberCarriages();
            
            for (int i = 0; i < _numberOfCarriages; i++)
            {
                List<Passanger> passangers = new List<Passanger>();
                _carriages.Add(new Carriage(passangers, 50, 20));
                _numberOfPassangersOut = _carriages[i].Fill(_numberOfPassangersOut);
            }
        }
        public int GetNumberCarriages()
        {
            int numberOfCarriages = _numberOfPassangersOut / 50;

            if (_numberOfPassangersOut % 50 != 0)
            {
                numberOfCarriages += 1;
            }
            return numberOfCarriages;
        }
        public bool CreateWay(City city)
        {
            Console.SetCursorPosition(10, 10);
            _direction = city;
            if (_direction == _location)
            {
                Console.WriteLine("Вы уже в этом городе, выберите другой город!\nНажмите любую клавишу для продолжения...");
                Console.ReadKey();
                return false;
            }
            else
            {
                Console.WriteLine($"Создано направление {_location.Name} - {_direction.Name}\nНажмите любую клавишу для продолжения...");
               
                return true;
            }
        }
        public void GoToNextCity()
        {
            Renderer renderer = new Renderer(0, 0);
            List<City> cities = new List<City>();
            cities.Add(new City("Москва"));
            cities.Add(new City("Питер"));
            cities.Add(new City("Казань"));
            cities.Add(new City("Владивосток"));

            if (CreateWay(cities[2]))
            {
                Fill();
                renderer.DrawInfoWindow(_location.Name, _direction.Name, _numberOfPassangersIn, _numberOfCarriages);
            }
            Console.ReadKey();
        }
    }
    class Carriage
    {
        Random rand = new Random();
        public int _maxPlace { get; private set; }
        public int _price { get; private set; }
        private List<Passanger> _passangers = new List<Passanger>();

        public Carriage(List<Passanger> passangers, int maxPlace, int price)
        {
            _maxPlace = maxPlace;
            _price = price;
            _passangers = passangers;
        }
        public int Fill(int numberOfPassangers)
        {
            if (numberOfPassangers >= _maxPlace)
            {
                for (int i = 0; i < _maxPlace; i++)
                {
                    _passangers.Add(new Passanger(rand.Next(100, 150)));
                    _passangers[i].BuyTicket(_price);
                }
                return numberOfPassangers -= _maxPlace;
            }
            else
            {
                for (int i = 0; i < numberOfPassangers; i++)
                {
                    _passangers.Add(new Passanger(rand.Next(50, 150)));
                    _passangers[i].BuyTicket(_price);
                }
                return numberOfPassangers = 0;
            }
        }
    }
    class City
    {
        public string Name { get; private set; }

        public City(string name)
        {
            Name = name;
        }
    }
    class Passanger
    {
        private int _money;

        public Passanger(int money)
        {
            _money = money;
        }

        public void BuyTicket(int price)
        {
            if (_money >= price)
            {
                _money -= price;
            }
            else
            {
                Console.WriteLine("У пассажира не хватило денег!");
                Console.ReadKey();
            }
        }
    }
    class Renderer
    {
        private int _x;
        private int _y;

        public Renderer(int x, int y)
        {
            _x = x;
            _y = y;
        }
        public void DrawInfoWindow(string location,string direction, int numberOfPassangers, int numberOfCarriages)
        {
            Console.SetCursorPosition(_x,_y);
            Console.WriteLine($"Рейс:           {location} - {direction}\nЧеловек на борту: {numberOfPassangers}\nКоличество вагонов: {numberOfCarriages}");
            Console.SetCursorPosition(10, 10);
        }
    }
}
